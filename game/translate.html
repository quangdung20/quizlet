<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translate Modal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container my-5">
        <h1>Translate Modal Example</h1>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#translateModal">Open Translate
            Modal</button>
    </div>

    <div class="modal fade" id="translateModal" tabindex="-1" aria-labelledby="translateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="translateModalLabel">Translate with Google</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="textToTranslate" class="form-label">Text to Translate</label>
                        <textarea id="textToTranslate" class="form-control" rows="3"
                            placeholder="Enter text here..."></textarea>
                        <button id="startRecognition" class="btn btn-outline-secondary mt-2">🎙 Start Voice
                            Input</button>
                    </div>
                    <div class="mb-3">
                        <label for="sourceLanguage" class="form-label">Source Language</label>
                        <select id="sourceLanguage" class="form-select">
                            <option value="auto" selected>Detect Language</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="vi">Vietnamese</option>
                            <!-- Add more languages as needed -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="targetLanguage" class="form-label">Target Language</label>
                        <select id="targetLanguage" class="form-select">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="vi">Vietnamese</option>
                            <!-- Add more languages as needed -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="voiceSelect" class="form-label">Choose Voice</label>
                        <select id="voiceSelect" class="form-select">
                            <option value="">Default Voice</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="playText" class="btn btn-success">🔊 Play Text</button>
                    <button type="button" id="openTranslateBtn" class="btn btn-primary">Translate</button>
                </div>
            </div>
        </div>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
        // DOM Elements
        const openTranslateBtn = document.getElementById("openTranslateBtn");
        const textToTranslate = document.getElementById("textToTranslate");
        const sourceLanguage = document.getElementById("sourceLanguage");
        const targetLanguage = document.getElementById("targetLanguage");
        const playTextBtn = document.getElementById("playText");
        const startRecognitionBtn = document.getElementById("startRecognition");

        const voiceSelect = document.getElementById("voiceSelect");

        // Hàm tải danh sách giọng nói
        function loadVoices() {
            const voices = speechSynthesis.getVoices();
            voiceSelect.innerHTML = ""; // Xóa các lựa chọn cũ

            voices.forEach((voice, index) => {
                const option = document.createElement("option");
                option.value = index; // Dùng chỉ số làm giá trị
                option.textContent = `${voice.name} (${voice.lang}) ${voice.default ? "- Default" : ""}`;
                voiceSelect.appendChild(option);
            });
        }

        // Lắng nghe sự kiện tải giọng nói
        if (typeof speechSynthesis !== "undefined") {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // Hàm Text-to-Speech với lựa chọn giọng nói
        function textToSpeech(text, lang = "en-US") {
            const speech = new SpeechSynthesisUtterance(text);
            const voices = speechSynthesis.getVoices();
            const selectedVoiceIndex = voiceSelect.value;

            if (selectedVoiceIndex && voices[selectedVoiceIndex]) {
                speech.voice = voices[selectedVoiceIndex]; // Gán giọng nói
            } else {
                // Sử dụng giọng mặc định
                const defaultVoice = voices.find((voice) => voice.lang.startsWith(lang));
                if (defaultVoice) {
                    speech.voice = defaultVoice;
                }
            }

            speech.lang = lang;
            speechSynthesis.speak(speech);
        }

        // Nút phát văn bản
        playTextBtn.addEventListener("click", () => {
            const text = textToTranslate.value.trim();
            const lang = sourceLanguage.value === "auto" ? "en-US" : sourceLanguage.value;
            if (text) {
                textToSpeech(text, lang);
            } else {
                alert("Please enter some text to play.");
            }
        });

        // Khởi tạo danh sách giọng nói khi trang được tải
        document.addEventListener("DOMContentLoaded", loadVoices);




        // Speech Recognition (Voice-to-Text)
        function startSpeechRecognition() {
            if (!("webkitSpeechRecognition" in window || "SpeechRecognition" in window)) {
                alert("Your browser does not support Speech Recognition.");
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.lang = sourceLanguage.value === "auto" ? "en-US" : sourceLanguage.value;
            recognition.interimResults = false;

            recognition.onstart = () => {
                startRecognitionBtn.textContent = "🎙 Listening...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                textToTranslate.value = transcript;
            };

            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
            };

            recognition.onend = () => {
                startRecognitionBtn.textContent = "🎙 Start Voice Input";
            };

            recognition.start();
        }

        // Start recognition button
        startRecognitionBtn.addEventListener("click", startSpeechRecognition);


        async function translateWithLibre() {
            const text = textToTranslate.value.trim();
            const sourceLang = sourceLanguage.value;
            const targetLang = targetLanguage.value;

            if (!text.trim()) {
                alert("Please enter text to translate.");
                return;
            }

            try {
                const response = await fetch("https://libretranslate.de/translate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        q: text,
                        source: sourceLang,
                        target: targetLang,
                        format: "text",
                    }),
                });

                if (!response.ok) {
                    throw new Error("Error while translating text");
                }

                const result = await response.json();
                document.getElementById("translationResult").textContent = result.translatedText;
            } catch (error) {
                console.error(error);
                alert("Failed to translate the text.");
            }
        }

        // Open Google Translate in a new tab
        openTranslateBtn.addEventListener("click", () => {
            const text = textToTranslate.value.trim();
            const sourceLang = sourceLanguage.value;
            const targetLang = targetLanguage.value;

            if (!text) {
                alert("Please enter text to translate.");
                return;
            }

            // Construct Google Translate URL
            const translateURL = `https://translate.google.com/?sl=${sourceLang}&tl=${targetLang}&text=${encodeURIComponent(text)}&op=translate`;

            // Open URL in a new tab
            window.open(translateURL, "_blank");
        });

    </script>
</body>

</html>